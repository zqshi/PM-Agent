<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProductCoCreate AI - 挑战与裁决</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#4f46e5',
                        success: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', system-ui, sans-serif;
            background-color: #f8fafc;
        }
        .sidebar {
            width: 250px;
        }
        .challenge-card {
            transition: all 0.3s ease;
        }
        .decision-option {
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid #e5e7eb;
        }
        .decision-option:hover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .decision-option input[type="radio"]:checked + .option-content {
            border-color: #2563eb;
            background-color: #dbeafe;
        }
        .challenge-nav-item {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .challenge-nav-item:hover {
            background-color: #f3f4f6;
        }
        .challenge-nav-item.active {
            background-color: #dbeafe;
            border-left: 4px solid #2563eb;
        }
        .custom-input-area {
            display: none;
            margin-top: 12px;
        }
        .custom-input-area.active {
            display: block;
        }
    </style>
</head>
<body class="min-h-screen flex">
    <!-- Sidebar -->
    <aside class="sidebar bg-white shadow-md h-screen fixed left-0 top-0 z-10">
        <div class="p-4 flex items-center justify-between border-b">
            <div class="flex items-center">
                <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/e10cd3e372b34c81bd38e133e4bd5b6f~tplv-a9rns2rl98-image.image?rcl=202510281322428F39A82D876F62A3D046&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1764221004&x-signature=F1qcXPuf02II05L0PsQjVA3rO4o%3D" alt="Logo" class="h-8">
                <h1 class="ml-2 text-lg font-bold text-gray-800">ProductCoCreate</h1>
            </div>
        </div>
        <nav class="mt-4">
            <ul>
                <li>
                    <a href="dashboard.html" class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 transition-all">
                        <i class="fa fa-dashboard w-6 text-center"></i>
                        <span class="ml-3">仪表盘</span>
                    </a>
                </li>
                <li>
                    <a href="project-management.html" class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 transition-all">
                        <i class="fa fa-folder-open w-6 text-center"></i>
                        <span class="ml-3">项目管理</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="bg-blue-50 text-primary border-l-4 border-primary flex items-center px-4 py-3 hover:bg-blue-50 transition-all">
                        <i class="fa fa-gavel w-6 text-center"></i>
                        <span class="ml-3">挑战与裁决</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 transition-all" onclick="event.preventDefault(); alert('系统设置功能正在开发中，敬请期待！');">
                        <i class="fa fa-cog w-6 text-center"></i>
                        <span class="ml-3">系统设置</span>
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="ml-64 flex-1 min-h-screen flex">
        <!-- Left: Challenge Navigation -->
        <div class="w-80 bg-white border-r h-screen sticky top-0 overflow-y-auto">
            <div class="p-6 border-b">
                <h2 class="text-xl font-bold text-gray-800 mb-2">挑战问题列表</h2>
                <p class="text-sm text-gray-600">共 3 个待裁决问题</p>
                <div class="mt-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700">裁决进度</span>
                        <span class="text-sm font-medium text-primary" id="navProgressText">0/3</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full transition-all duration-500" style="width: 0%" id="navProgressBar"></div>
                    </div>
                </div>
            </div>

            <div class="p-4 space-y-2" id="challengeNav">
                <div class="challenge-nav-item active p-4 rounded-lg border" data-challenge-id="1" onclick="switchChallenge(1)">
                    <div class="flex items-start justify-between mb-2">
                        <span class="text-sm font-bold text-gray-800">问题 1</span>
                        <span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs" data-status="pending">待裁决</span>
                    </div>
                    <p class="text-sm text-gray-600">用户故事粒度过粗</p>
                </div>

                <div class="challenge-nav-item p-4 rounded-lg border" data-challenge-id="2" onclick="switchChallenge(2)">
                    <div class="flex items-start justify-between mb-2">
                        <span class="text-sm font-bold text-gray-800">问题 2</span>
                        <span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs" data-status="pending">待裁决</span>
                    </div>
                    <p class="text-sm text-gray-600">功能边界不清晰</p>
                </div>

                <div class="challenge-nav-item p-4 rounded-lg border" data-challenge-id="3" onclick="switchChallenge(3)">
                    <div class="flex items-start justify-between mb-2">
                        <span class="text-sm font-bold text-gray-800">问题 3</span>
                        <span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs" data-status="pending">待裁决</span>
                    </div>
                    <p class="text-sm text-gray-600">验收标准不够具体</p>
                </div>
            </div>
        </div>

        <!-- Right: Challenge Details -->
        <div class="flex-1 p-6 overflow-y-auto">
            <!-- Breadcrumb -->
            <nav class="flex mb-6 text-sm">
                <a href="project-management.html" class="text-primary hover:text-secondary">项目管理</a>
                <span class="mx-2 text-gray-400">/</span>
                <a href="project-detail.html?id=1" class="text-primary hover:text-secondary">移动应用重新设计</a>
                <span class="mx-2 text-gray-400">/</span>
                <a href="version-detail.html?projectId=1&versionId=2" class="text-primary hover:text-secondary">v2.0</a>
                <span class="mx-2 text-gray-400">/</span>
                <span class="text-gray-600">挑战与裁决</span>
            </nav>

            <!-- Header -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center mb-3">
                            <h1 class="text-3xl font-bold text-gray-800">步骤1.4-1.7：挑战与裁决</h1>
                            <span class="ml-4 px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm font-medium">
                                <i class="fa fa-gavel mr-1"></i>待裁决
                            </span>
                        </div>
                        <p class="text-gray-600 mb-4">挑战Agent已识别设计文档中的潜在问题，设计Agent已进行回应，请您进行最终裁决。</p>
                        <div class="flex items-center space-x-4 text-sm text-gray-600">
                            <span><i class="fa fa-calendar mr-2"></i>开始时间: 2025-10-28 14:20</span>
                            <span><i class="fa fa-user mr-2"></i>负责人: 张三</span>
                            <span><i class="fa fa-list mr-2"></i>问题数量: 3个</span>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button class="px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-all" onclick="saveAllDecisions()">
                            <i class="fa fa-save mr-2"></i>保存所有裁决
                        </button>
                        <button class="px-4 py-2 bg-primary text-white rounded-md hover:bg-secondary transition-all" id="submitBtn" onclick="submitAllDecisions()" disabled>
                            <i class="fa fa-check mr-2"></i>提交裁决
                        </button>
                    </div>
                </div>
            </div>

            <!-- Challenge Content -->
            <div id="challengeContent">
                <!-- Challenge 1 -->
                <div class="challenge-detail" data-challenge-id="1" style="display: block;">
                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-2xl font-bold text-gray-800">
                                <span class="inline-block w-8 h-8 bg-primary text-white rounded-full text-center leading-8 mr-2">1</span>
                                用户故事粒度过粗
                            </h2>
                            <span class="text-sm text-gray-500">问题来源: 步骤1.3 需求设计文档</span>
                        </div>

                        <!-- 三段式展示 -->
                        <!-- 1. 挑战Agent观点 -->
                        <div class="challenge-card bg-red-50 border-l-4 border-red-500 rounded-lg p-6 mb-4">
                            <div class="flex items-center mb-3">
                                <div class="w-10 h-10 rounded-full bg-red-500 flex items-center justify-center text-white mr-3">
                                    <i class="fa fa-exclamation-triangle"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg text-gray-800">🔴 挑战Agent观点</h3>
                                    <p class="text-xs text-gray-500">由挑战Agent提出的潜在问题</p>
                                </div>
                            </div>
                            <div class="bg-white rounded-lg p-4">
                                <p class="text-gray-700 mb-3">
                                    <strong>问题描述：</strong>当前设计文档中的用户故事"产品经理管理需求设计流程"范围过大，粒度过粗，不符合INVEST原则中的"Small"特性。
                                </p>
                                <p class="text-gray-700 mb-3">
                                    <strong>具体分析：</strong>
                                </p>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li>该用户故事涵盖了13个子步骤，过于庞大</li>
                                    <li>无法在一个Sprint内完成</li>
                                    <li>难以进行工作量估算</li>
                                    <li>增加了开发和测试的复杂度</li>
                                </ul>
                                <p class="text-gray-700 mt-3">
                                    <strong>建议修改方案：</strong>将大用户故事拆分为3-5个独立的、可独立交付的小用户故事，例如：
                                </p>
                                <ul class="list-decimal list-inside text-gray-700 space-y-1 ml-4 mt-2">
                                    <li>作为产品经理，我希望能澄清需求细节</li>
                                    <li>作为产品经理，我希望能进行市场调研分析</li>
                                    <li>作为产品经理，我希望能生成标准化需求文档</li>
                                </ul>
                            </div>
                        </div>

                        <!-- 2. 设计Agent回应 -->
                        <div class="challenge-card bg-blue-50 border-l-4 border-blue-500 rounded-lg p-6 mb-4">
                            <div class="flex items-center mb-3">
                                <div class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white mr-3">
                                    <i class="fa fa-reply"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg text-gray-800">🔵 设计Agent回应</h3>
                                    <p class="text-xs text-gray-500">设计Agent对挑战的回应和辩护</p>
                                </div>
                            </div>
                            <div class="bg-white rounded-lg p-4">
                                <p class="text-gray-700 mb-3">
                                    <strong>回应观点：</strong>部分同意挑战Agent的观点，但建议采用Epic-Story层级结构而非完全拆分。
                                </p>
                                <p class="text-gray-700 mb-3">
                                    <strong>理由分析：</strong>
                                </p>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li>需求设计流程具有内在的逻辑连贯性，完全拆分可能破坏整体性</li>
                                    <li>产品经理需要在一个统一的视图中管理整个流程</li>
                                    <li>某些子步骤之间存在强依赖关系，不宜分离</li>
                                </ul>
                                <p class="text-gray-700 mt-3">
                                    <strong>建议方案：</strong>保留"产品经理管理需求设计流程"作为Epic（史诗），下层拆分为5个具体的User Story：
                                </p>
                                <ul class="list-decimal list-inside text-gray-700 space-y-1 ml-4 mt-2">
                                    <li>需求澄清与收集 (包含步骤1.1)</li>
                                    <li>市场调研与分析 (包含步骤1.2)</li>
                                    <li>需求设计与文档生成 (包含步骤1.3)</li>
                                    <li>设计挑战与裁决 (包含步骤1.4-1.7)</li>
                                    <li>文档评估与精炼 (包含步骤1.8-1.13)</li>
                                </ul>
                                <p class="text-gray-700 mt-3 text-sm italic">
                                    这样既保留了流程的整体性，又满足了Story的粒度要求。
                                </p>
                            </div>
                        </div>

                        <!-- 3. 人类裁决 -->
                        <div class="challenge-card bg-gradient-to-br from-purple-50 to-indigo-50 border-l-4 border-purple-500 rounded-lg p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 rounded-full bg-purple-500 flex items-center justify-center text-white mr-3">
                                    <i class="fa fa-user"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg text-gray-800">👤 您的裁决决策</h3>
                                    <p class="text-xs text-gray-500">请选择一个方案或提出自定义修改意见</p>
                                </div>
                            </div>

                            <div class="space-y-3">
                                <!-- Option 1: 采纳挑战 -->
                                <label class="decision-option block rounded-lg p-4">
                                    <input type="radio" name="decision_1" value="adopt_challenge" class="hidden" onchange="handleDecisionChange(1, 'adopt_challenge')">
                                    <div class="option-content rounded-lg p-4">
                                        <div class="flex items-start">
                                            <div class="flex-shrink-0 mt-1">
                                                <div class="w-5 h-5 rounded-full border-2 border-gray-400 flex items-center justify-center">
                                                    <div class="w-3 h-3 rounded-full bg-primary hidden"></div>
                                                </div>
                                            </div>
                                            <div class="ml-3 flex-1">
                                                <p class="font-bold text-gray-800 mb-1">采纳挑战Agent方案</p>
                                                <p class="text-sm text-gray-600">将大用户故事拆分为3-5个独立的小用户故事，完全消除粒度过粗的问题。</p>
                                            </div>
                                        </div>
                                    </div>
                                </label>

                                <!-- Option 2: 采纳回应 -->
                                <label class="decision-option block rounded-lg p-4">
                                    <input type="radio" name="decision_1" value="adopt_response" class="hidden" onchange="handleDecisionChange(1, 'adopt_response')">
                                    <div class="option-content rounded-lg p-4">
                                        <div class="flex items-start">
                                            <div class="flex-shrink-0 mt-1">
                                                <div class="w-5 h-5 rounded-full border-2 border-gray-400 flex items-center justify-center">
                                                    <div class="w-3 h-3 rounded-full bg-primary hidden"></div>
                                                </div>
                                            </div>
                                            <div class="ml-3 flex-1">
                                                <p class="font-bold text-gray-800 mb-1">采纳设计Agent方案</p>
                                                <p class="text-sm text-gray-600">采用Epic-Story层级结构，保留Epic并拆分为5个子Story，兼顾整体性和粒度。</p>
                                            </div>
                                        </div>
                                    </div>
                                </label>

                                <!-- Option 3: 自定义修改 -->
                                <label class="decision-option block rounded-lg p-4">
                                    <input type="radio" name="decision_1" value="custom" class="hidden" onchange="handleDecisionChange(1, 'custom')">
                                    <div class="option-content rounded-lg p-4">
                                        <div class="flex items-start">
                                            <div class="flex-shrink-0 mt-1">
                                                <div class="w-5 h-5 rounded-full border-2 border-gray-400 flex items-center justify-center">
                                                    <div class="w-3 h-3 rounded-full bg-primary hidden"></div>
                                                </div>
                                            </div>
                                            <div class="ml-3 flex-1">
                                                <p class="font-bold text-gray-800 mb-1">自定义修改方案</p>
                                                <p class="text-sm text-gray-600 mb-3">提出您自己的解决方案</p>
                                                <div class="custom-input-area" data-challenge-id="1">
                                                    <textarea
                                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        rows="4"
                                                        placeholder="请详细描述您的自定义修改方案...&#10;&#10;例如：&#10;采用Epic-Story结构，但Story数量限制在3个以内，每个Story覆盖更大的功能范围..."
                                                        data-custom-input="1"
                                                        oninput="handleCustomInput(1)"
                                                    ></textarea>
                                                    <p class="text-xs text-gray-500 mt-2">已输入 <span id="customCharCount1">0</span> 字符</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="flex items-center justify-between mt-6">
                        <button class="px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-all" disabled>
                            <i class="fa fa-chevron-left mr-2"></i>上一个问题
                        </button>
                        <button class="px-6 py-2 bg-primary text-white rounded-md hover:bg-secondary transition-all" onclick="switchChallenge(2)">
                            下一个问题<i class="fa fa-chevron-right ml-2"></i>
                        </button>
                    </div>
                </div>

                <!-- Challenge 2 -->
                <div class="challenge-detail" data-challenge-id="2" style="display: none;">
                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-2xl font-bold text-gray-800">
                                <span class="inline-block w-8 h-8 bg-primary text-white rounded-full text-center leading-8 mr-2">2</span>
                                功能边界不清晰
                            </h2>
                            <span class="text-sm text-gray-500">问题来源: 步骤1.3 需求设计文档</span>
                        </div>

                        <!-- 三段式展示 -->
                        <div class="challenge-card bg-red-50 border-l-4 border-red-500 rounded-lg p-6 mb-4">
                            <div class="flex items-center mb-3">
                                <div class="w-10 h-10 rounded-full bg-red-500 flex items-center justify-center text-white mr-3">
                                    <i class="fa fa-exclamation-triangle"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg text-gray-800">🔴 挑战Agent观点</h3>
                                    <p class="text-xs text-gray-500">由挑战Agent提出的潜在问题</p>
                                </div>
                            </div>
                            <div class="bg-white rounded-lg p-4">
                                <p class="text-gray-700 mb-3">
                                    <strong>问题描述：</strong>需求设计文档中提到"与现有系统集成"，但未明确说明集成的范围和边界。
                                </p>
                                <p class="text-gray-700 mb-3">
                                    <strong>具体分析：</strong>
                                </p>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li>未说明需要与哪些系统集成</li>
                                    <li>未定义集成的深度（数据同步 vs API调用）</li>
                                    <li>缺少集成失败的降级方案</li>
                                </ul>
                                <p class="text-gray-700 mt-3">
                                    <strong>建议修改方案：</strong>明确集成范围，列出所有集成点，定义集成接口规范。
                                </p>
                            </div>
                        </div>

                        <div class="challenge-card bg-blue-50 border-l-4 border-blue-500 rounded-lg p-6 mb-4">
                            <div class="flex items-center mb-3">
                                <div class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white mr-3">
                                    <i class="fa fa-reply"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg text-gray-800">🔵 设计Agent回应</h3>
                                    <p class="text-xs text-gray-500">设计Agent对挑战的回应和辩护</p>
                                </div>
                            </div>
                            <div class="bg-white rounded-lg p-4">
                                <p class="text-gray-700 mb-3">
                                    <strong>回应观点：</strong>同意挑战Agent的观点，这确实是需要补充的内容。
                                </p>
                                <p class="text-gray-700 mb-3">
                                    <strong>建议补充：</strong>
                                </p>
                                <ul class="list-decimal list-inside text-gray-700 space-y-1 ml-4">
                                    <li>添加"系统集成"章节，明确集成范围</li>
                                    <li>列出需要集成的系统清单（CRM、ERP等）</li>
                                    <li>定义集成方式和技术方案</li>
                                    <li>制定集成异常处理策略</li>
                                </ul>
                            </div>
                        </div>

                        <div class="challenge-card bg-gradient-to-br from-purple-50 to-indigo-50 border-l-4 border-purple-500 rounded-lg p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 rounded-full bg-purple-500 flex items-center justify-center text-white mr-3">
                                    <i class="fa fa-user"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg text-gray-800">👤 您的裁决决策</h3>
                                    <p class="text-xs text-gray-500">请选择一个方案或提出自定义修改意见</p>
                                </div>
                            </div>

                            <div class="space-y-3">
                                <label class="decision-option block rounded-lg p-4">
                                    <input type="radio" name="decision_2" value="adopt_challenge" class="hidden" onchange="handleDecisionChange(2, 'adopt_challenge')">
                                    <div class="option-content rounded-lg p-4">
                                        <div class="flex items-start">
                                            <div class="flex-shrink-0 mt-1">
                                                <div class="w-5 h-5 rounded-full border-2 border-gray-400 flex items-center justify-center">
                                                    <div class="w-3 h-3 rounded-full bg-primary hidden"></div>
                                                </div>
                                            </div>
                                            <div class="ml-3 flex-1">
                                                <p class="font-bold text-gray-800 mb-1">采纳挑战Agent方案</p>
                                                <p class="text-sm text-gray-600">明确集成范围，列出所有集成点。</p>
                                            </div>
                                        </div>
                                    </div>
                                </label>

                                <label class="decision-option block rounded-lg p-4">
                                    <input type="radio" name="decision_2" value="adopt_response" class="hidden" onchange="handleDecisionChange(2, 'adopt_response')">
                                    <div class="option-content rounded-lg p-4">
                                        <div class="flex items-start">
                                            <div class="flex-shrink-0 mt-1">
                                                <div class="w-5 h-5 rounded-full border-2 border-gray-400 flex items-center justify-center">
                                                    <div class="w-3 h-3 rounded-full bg-primary hidden"></div>
                                                </div>
                                            </div>
                                            <div class="ml-3 flex-1">
                                                <p class="font-bold text-gray-800 mb-1">采纳设计Agent方案</p>
                                                <p class="text-sm text-gray-600">添加详细的系统集成章节和技术方案。</p>
                                            </div>
                                        </div>
                                    </div>
                                </label>

                                <label class="decision-option block rounded-lg p-4">
                                    <input type="radio" name="decision_2" value="custom" class="hidden" onchange="handleDecisionChange(2, 'custom')">
                                    <div class="option-content rounded-lg p-4">
                                        <div class="flex items-start">
                                            <div class="flex-shrink-0 mt-1">
                                                <div class="w-5 h-5 rounded-full border-2 border-gray-400 flex items-center justify-center">
                                                    <div class="w-3 h-3 rounded-full bg-primary hidden"></div>
                                                </div>
                                            </div>
                                            <div class="ml-3 flex-1">
                                                <p class="font-bold text-gray-800 mb-1">自定义修改方案</p>
                                                <p class="text-sm text-gray-600 mb-3">提出您自己的解决方案</p>
                                                <div class="custom-input-area" data-challenge-id="2">
                                                    <textarea
                                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        rows="4"
                                                        placeholder="请详细描述您的自定义修改方案..."
                                                        data-custom-input="2"
                                                        oninput="handleCustomInput(2)"
                                                    ></textarea>
                                                    <p class="text-xs text-gray-500 mt-2">已输入 <span id="customCharCount2">0</span> 字符</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center justify-between mt-6">
                        <button class="px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-all" onclick="switchChallenge(1)">
                            <i class="fa fa-chevron-left mr-2"></i>上一个问题
                        </button>
                        <button class="px-6 py-2 bg-primary text-white rounded-md hover:bg-secondary transition-all" onclick="switchChallenge(3)">
                            下一个问题<i class="fa fa-chevron-right ml-2"></i>
                        </button>
                    </div>
                </div>

                <!-- Challenge 3 -->
                <div class="challenge-detail" data-challenge-id="3" style="display: none;">
                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-2xl font-bold text-gray-800">
                                <span class="inline-block w-8 h-8 bg-primary text-white rounded-full text-center leading-8 mr-2">3</span>
                                验收标准不够具体
                            </h2>
                            <span class="text-sm text-gray-500">问题来源: 步骤1.3 需求设计文档</span>
                        </div>

                        <div class="challenge-card bg-red-50 border-l-4 border-red-500 rounded-lg p-6 mb-4">
                            <div class="flex items-center mb-3">
                                <div class="w-10 h-10 rounded-full bg-red-500 flex items-center justify-center text-white mr-3">
                                    <i class="fa fa-exclamation-triangle"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg text-gray-800">🔴 挑战Agent观点</h3>
                                    <p class="text-xs text-gray-500">由挑战Agent提出的潜在问题</p>
                                </div>
                            </div>
                            <div class="bg-white rounded-lg p-4">
                                <p class="text-gray-700 mb-3">
                                    <strong>问题描述：</strong>验收标准使用了"用户体验良好"、"性能满足要求"等模糊描述，缺乏可量化的指标。
                                </p>
                                <p class="text-gray-700 mb-3">
                                    <strong>建议修改方案：</strong>将所有验收标准改为可量化、可测试的指标。
                                </p>
                            </div>
                        </div>

                        <div class="challenge-card bg-blue-50 border-l-4 border-blue-500 rounded-lg p-6 mb-4">
                            <div class="flex items-center mb-3">
                                <div class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white mr-3">
                                    <i class="fa fa-reply"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg text-gray-800">🔵 设计Agent回应</h3>
                                    <p class="text-xs text-gray-500">设计Agent对挑战的回应和辩护</p>
                                </div>
                            </div>
                            <div class="bg-white rounded-lg p-4">
                                <p class="text-gray-700 mb-3">
                                    <strong>回应观点：</strong>同意需要具体化，建议补充量化指标，例如"页面加载时间<2秒"、"用户满意度≥4.5分"等。
                                </p>
                            </div>
                        </div>

                        <div class="challenge-card bg-gradient-to-br from-purple-50 to-indigo-50 border-l-4 border-purple-500 rounded-lg p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 rounded-full bg-purple-500 flex items-center justify-center text-white mr-3">
                                    <i class="fa fa-user"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg text-gray-800">👤 您的裁决决策</h3>
                                    <p class="text-xs text-gray-500">请选择一个方案或提出自定义修改意见</p>
                                </div>
                            </div>

                            <div class="space-y-3">
                                <label class="decision-option block rounded-lg p-4">
                                    <input type="radio" name="decision_3" value="adopt_challenge" class="hidden" onchange="handleDecisionChange(3, 'adopt_challenge')">
                                    <div class="option-content rounded-lg p-4">
                                        <div class="flex items-start">
                                            <div class="flex-shrink-0 mt-1">
                                                <div class="w-5 h-5 rounded-full border-2 border-gray-400 flex items-center justify-center">
                                                    <div class="w-3 h-3 rounded-full bg-primary hidden"></div>
                                                </div>
                                            </div>
                                            <div class="ml-3 flex-1">
                                                <p class="font-bold text-gray-800 mb-1">采纳挑战Agent方案</p>
                                                <p class="text-sm text-gray-600">将所有验收标准改为可量化指标。</p>
                                            </div>
                                        </div>
                                    </div>
                                </label>

                                <label class="decision-option block rounded-lg p-4">
                                    <input type="radio" name="decision_3" value="adopt_response" class="hidden" onchange="handleDecisionChange(3, 'adopt_response')">
                                    <div class="option-content rounded-lg p-4">
                                        <div class="flex items-start">
                                            <div class="flex-shrink-0 mt-1">
                                                <div class="w-5 h-5 rounded-full border-2 border-gray-400 flex items-center justify-center">
                                                    <div class="w-3 h-3 rounded-full bg-primary hidden"></div>
                                                </div>
                                            </div>
                                            <div class="ml-3 flex-1">
                                                <p class="font-bold text-gray-800 mb-1">采纳设计Agent方案</p>
                                                <p class="text-sm text-gray-600">补充具体的量化指标和测试方法。</p>
                                            </div>
                                        </div>
                                    </div>
                                </label>

                                <label class="decision-option block rounded-lg p-4">
                                    <input type="radio" name="decision_3" value="custom" class="hidden" onchange="handleDecisionChange(3, 'custom')">
                                    <div class="option-content rounded-lg p-4">
                                        <div class="flex items-start">
                                            <div class="flex-shrink-0 mt-1">
                                                <div class="w-5 h-5 rounded-full border-2 border-gray-400 flex items-center justify-center">
                                                    <div class="w-3 h-3 rounded-full bg-primary hidden"></div>
                                                </div>
                                            </div>
                                            <div class="ml-3 flex-1">
                                                <p class="font-bold text-gray-800 mb-1">自定义修改方案</p>
                                                <p class="text-sm text-gray-600 mb-3">提出您自己的解决方案</p>
                                                <div class="custom-input-area" data-challenge-id="3">
                                                    <textarea
                                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        rows="4"
                                                        placeholder="请详细描述您的自定义修改方案..."
                                                        data-custom-input="3"
                                                        oninput="handleCustomInput(3)"
                                                    ></textarea>
                                                    <p class="text-xs text-gray-500 mt-2">已输入 <span id="customCharCount3">0</span> 字符</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center justify-between mt-6">
                        <button class="px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-all" onclick="switchChallenge(2)">
                            <i class="fa fa-chevron-left mr-2"></i>上一个问题
                        </button>
                        <button class="px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-all" disabled>
                            下一个问题<i class="fa fa-chevron-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // 裁决数据存储
        let decisions = {};
        let completedDecisions = 0;
        const totalDecisions = 3;

        // 切换挑战问题
        function switchChallenge(challengeId) {
            // 更新导航栏
            document.querySelectorAll('.challenge-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.challenge-nav-item[data-challenge-id="${challengeId}"]`).classList.add('active');

            // 更新内容区
            document.querySelectorAll('.challenge-detail').forEach(detail => {
                detail.style.display = 'none';
            });
            document.querySelector(`.challenge-detail[data-challenge-id="${challengeId}"]`).style.display = 'block';

            // 滚动到顶部
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // 处理裁决决策
        function handleDecisionChange(challengeId, decisionType) {
            // 更新自定义输入区域显示状态
            const customInputArea = document.querySelector(`.custom-input-area[data-challenge-id="${challengeId}"]`);
            if (decisionType === 'custom') {
                customInputArea.classList.add('active');
            } else {
                customInputArea.classList.remove('active');

                // 记录决策
                if (!decisions[challengeId]) {
                    completedDecisions++;
                }
                decisions[challengeId] = {
                    type: decisionType,
                    customText: null
                };
                updateNavigationStatus(challengeId, 'completed');
                updateProgress();
            }
        }

        // 处理自定义输入
        function handleCustomInput(challengeId) {
            const textarea = document.querySelector(`textarea[data-custom-input="${challengeId}"]`);
            const charCount = textarea.value.length;
            document.getElementById(`customCharCount${challengeId}`).textContent = charCount;

            // 如果输入超过10个字符，认为决策完成
            if (charCount >= 10) {
                if (!decisions[challengeId]) {
                    completedDecisions++;
                }
                decisions[challengeId] = {
                    type: 'custom',
                    customText: textarea.value
                };
                updateNavigationStatus(challengeId, 'completed');
            } else {
                if (decisions[challengeId]) {
                    completedDecisions--;
                }
                delete decisions[challengeId];
                updateNavigationStatus(challengeId, 'pending');
            }
            updateProgress();
        }

        // 更新导航栏状态
        function updateNavigationStatus(challengeId, status) {
            const statusBadge = document.querySelector(`.challenge-nav-item[data-challenge-id="${challengeId}"] [data-status]`);
            if (status === 'completed') {
                statusBadge.innerHTML = '已裁决';
                statusBadge.className = 'px-2 py-1 bg-green-100 text-green-700 rounded text-xs';
            } else {
                statusBadge.innerHTML = '待裁决';
                statusBadge.className = 'px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs';
            }
        }

        // 更新进度
        function updateProgress() {
            const percentage = (completedDecisions / totalDecisions) * 100;
            document.getElementById('navProgressBar').style.width = percentage + '%';
            document.getElementById('navProgressText').textContent = `${completedDecisions}/${totalDecisions}`;

            // 更新提交按钮状态
            const submitBtn = document.getElementById('submitBtn');
            if (completedDecisions === totalDecisions) {
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                submitBtn.disabled = true;
                submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }

        // 保存所有裁决
        function saveAllDecisions() {
            localStorage.setItem('challengeDecisions', JSON.stringify(decisions));

            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            toast.innerHTML = '<i class="fa fa-check-circle mr-2"></i>所有裁决已保存';
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 2000);
        }

        // 提交所有裁决
        function submitAllDecisions() {
            if (completedDecisions !== totalDecisions) {
                alert('请完成所有问题的裁决');
                return;
            }

            if (confirm(`确认提交所有裁决？\n\n已完成: ${completedDecisions}/${totalDecisions}\n\n提交后将触发设计Agent根据您的裁决进行设计更新。`)) {
                const submitBtn = document.getElementById('submitBtn');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>提交中...';

                setTimeout(() => {
                    localStorage.removeItem('challengeDecisions');
                    alert('裁决已提交！设计Agent将根据您的裁决进行设计更新。');
                    window.location.href = 'version-detail.html?projectId=1&versionId=2';
                }, 1500);
            }
        }

        // 页面加载时恢复裁决
        window.addEventListener('DOMContentLoaded', () => {
            const savedDecisions = localStorage.getItem('challengeDecisions');
            if (savedDecisions) {
                decisions = JSON.parse(savedDecisions);
                completedDecisions = Object.keys(decisions).length;

                // 恢复决策状态
                Object.keys(decisions).forEach(challengeId => {
                    const decision = decisions[challengeId];
                    const radio = document.querySelector(`input[name="decision_${challengeId}"][value="${decision.type}"]`);
                    if (radio) {
                        radio.checked = true;
                        if (decision.type === 'custom' && decision.customText) {
                            const customArea = document.querySelector(`.custom-input-area[data-challenge-id="${challengeId}"]`);
                            customArea.classList.add('active');
                            const textarea = document.querySelector(`textarea[data-custom-input="${challengeId}"]`);
                            textarea.value = decision.customText;
                            document.getElementById(`customCharCount${challengeId}`).textContent = decision.customText.length;
                        }
                    }
                    updateNavigationStatus(parseInt(challengeId), 'completed');
                });

                updateProgress();
            }
        });
    </script>
</body>
</html>
