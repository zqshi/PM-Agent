# AI协作流程使用说明

## 概述

ProductCoCreate平台现已完整实现13步AI协作流程，实现了从需求到文档的全自动化产品设计流程。

## 完整流程演示

### 1. 创建项目版本
1. 打开项目详情页：`project-detail.html?id=1`
2. 点击【创建新版本】按钮
3. 填写版本信息：
   - **版本类型**：选择初始版本/补丁版本/次要版本/主要版本（自动生成语义化版本号）
   - **版本建设目标**：例如"实现用户管理系统"
   - **产品需求**：详细描述产品需求，支持多行输入
4. 点击【创建版本】

### 2. 自动创建流程
创建版本后，系统会：
- 自动创建一个AI协作流程
- 流程名称：`版本号 - 建设目标`
- 自动生成澄清问题文档
- 跳转到流程详情页

### 3. 流程详情页 (`process-flow-detail.html`)
显示13个步骤的完整流程：

#### 可点击的步骤：
- **步骤1.1 需求澄清**：点击进入澄清问题页面
- **步骤1.6 人类裁决**：当有挑战时，点击进入裁决页面

#### 流程概览：
- 整体进度百分比
- 已完成/进行中的步骤数
- 生成的文档数量
- 当前步骤和负责Agent

### 4. 需求澄清页面 (`clarification-interaction.html`)

#### 功能特性：
- **智能问题生成**：Product Manager Agent根据需求自动生成澄清问题
- **分类组织**：问题按类别组织（目标用户、功能范围、技术约束等）
- **实时保存**：答案自动保存到localStorage
- **进度跟踪**：左侧显示回答进度和分类导航
- **智能验证**：必须回答所有问题才能提交

#### 使用步骤：
1. 阅读原始需求（顶部黄色区域）
2. 逐个回答各分类下的澄清问题
3. 系统自动保存回答
4. 回答完所有问题后，点击【提交澄清回答】
5. 系统生成需求分析文档，进入下一步骤

### 5. 挑战裁决页面 (`challenge-decision.html`)

#### 适用场景：
当Architect Agent对Product Manager的设计提出挑战时启用

#### 功能特性：
- **双方观点展示**：清晰展示PM和Architect的不同观点
- **三种裁决选项**：
  - 支持PM：采纳原设计
  - 支持Architect：采纳挑战观点
  - 自定义方案：提出折中方案
- **理由说明**：可选填写裁决理由
- **进度跟踪**：左侧显示待裁决挑战列表

#### 使用步骤：
1. 阅读PM和Architect的观点及理由
2. 为每个挑战选择一个裁决选项
3. 如选择自定义方案，必须填写具体方案
4. 可选填写裁决理由
5. 点击【提交裁决结果】
6. 系统根据裁决更新设计文档

## 13步流程说明

### 阶段一：需求理解与分析
1. **1.1 需求澄清** (可交互)
   - Product Manager Agent生成澄清问题
   - 用户回答问题
   - 系统评估是否需要进一步澄清

2. **1.2 市场调研**
   - PM Agent进行市场调研（自动）
   - 生成市场调研报告

3. **1.3 需求设计**
   - PM Agent生成初始需求设计文档
   - 包含功能列表、用户故事等

### 阶段二：设计挑战与裁决
4. **1.4 设计挑战**
   - Architect Agent审查设计
   - 对不合理部分提出挑战

5. **1.5 挑战回应**
   - PM Agent对挑战做出回应
   - 说明设计理由

6. **1.6 人类裁决** (可交互)
   - 用户审查双方观点
   - 做出最终裁决

### 阶段三：文档更新与评估
7. **1.7 设计更新**
   - PM Agent根据裁决更新文档

8. **1.8 人类评估**
   - 用户评估更新后的文档
   - 提出修改意见

9. **1.9 文档修改**
   - PM Agent根据评估修改文档

### 阶段四：质量保证
10. **1.11 差异检查**
    - Tech Writer Agent检查文档一致性
    - 与原始需求对比

11. **1.12 文档精炼**
    - Tech Writer优化文档质量
    - 统一格式和术语

12. **1.13 强制检查点**
    - 最终质量检查
    - 确保文档完整性

## 数据存储

### LocalStorage结构
```javascript
{
  "process_flows": {
    "process_xxx": {
      "id": "process_xxx",
      "name": "流程名称",
      "requirement": "原始需求",
      "currentStep": "1.1",
      "status": "in_progress",
      "steps": {
        "1.1": { /* 步骤详情 */ },
        // ... 其他步骤
      },
      "documents": [
        {
          "id": "doc_xxx",
          "type": "clarification_questions",
          "version": 1,
          "content": { /* 文档内容 */ }
        }
      ]
    }
  }
}
```

## 技术实现

### 核心服务层：`js/process-flow-service.js`
- **ProcessFlowService类**：管理整个流程生命周期
- **智能问题生成**：基于关键词的上下文感知问题生成
- **状态机管理**：自动推进流程步骤
- **文档版本控制**：支持文档迭代和依赖追踪

### 页面文件
- `project-detail.html`：项目管理和版本创建
- `process-flow-detail.html`：流程概览和步骤导航
- `clarification-interaction.html`：需求澄清交互
- `challenge-decision.html`：挑战裁决交互

## 最佳实践

### 1. 编写产品需求
```
示例：
实现一个用户管理系统，支持用户注册、登录、权限管理功能。
需要支持第三方登录（微信、支付宝）。
管理员可以查看所有用户信息和操作日志。
系统需要支持10万+用户规模。
```

### 2. 回答澄清问题
- **详细具体**：提供足够的上下文信息
- **考虑场景**：说明典型使用场景
- **技术约束**：明确技术限制和性能要求
- **优先级**：说明功能的优先级

### 3. 做出裁决决策
- **平衡考虑**：兼顾技术可行性和业务价值
- **长远规划**：考虑系统的可扩展性
- **用户价值**：以用户需求为核心
- **说明理由**：清晰表达决策依据

## 未来扩展

当前实现了核心的人机交互步骤（1.1需求澄清、1.6人类裁决）。未来可以扩展：

1. **1.8 人类评估**：添加文档评估和反馈界面
2. **文档预览**：实时预览生成的文档
3. **历史记录**：查看流程的完整历史
4. **协作功能**：支持多人协作评审
5. **导出功能**：导出最终文档为PDF/Word
6. **模板管理**：自定义问题模板和流程模板

## 常见问题

### Q: 为什么只能创建一个流程？
A: 根据产品设计，每个版本对应一个完整的AI协作流程。如果需要处理多个独立需求，建议创建多个版本。

### Q: 数据保存在哪里？
A: 当前使用localStorage保存数据。刷新页面数据不会丢失，但清除浏览器缓存会导致数据丢失。

### Q: 可以跳过某些步骤吗？
A: 不建议跳过。13步流程设计为完整的质量保证体系，跳过步骤可能影响文档质量。

### Q: 如何修改已提交的澄清回答？
A: 目前提交后无法直接修改。需要在服务层添加编辑功能。

## 演示流程

### 快速测试（5分钟）
1. 打开 `project-detail.html?id=1`
2. 点击【创建新版本】
3. 选择"初始版本"，输入：
   - 目标：实现用户管理
   - 需求：实现用户注册登录功能
4. 创建后自动跳转到流程详情
5. 点击步骤1.1进入澄清页面
6. 回答所有问题并提交

### 完整测试（15分钟）
1. 执行上述快速测试
2. 在流程详情页查看13个步骤
3. 查看生成的澄清问题文档
4. 模拟挑战场景（需要修改服务层代码生成挑战）
5. 在步骤1.6进行裁决

## 技术支持

如有问题，请查看：
- 浏览器控制台：检查JavaScript错误
- LocalStorage：检查数据是否正确保存
- 服务层日志：`processFlowService` 输出的调试信息

---

最后更新：2025-10-28
版本：v1.0.0
